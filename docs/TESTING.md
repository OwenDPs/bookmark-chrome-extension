# Bookmark Manager Chrome Extension - 测试指南

本文档提供了测试 Bookmark Manager Chrome 扩展的详细指南，包括功能测试、集成测试和性能测试。

## 目录

1. [测试环境准备](#测试环境准备)
2. [功能测试](#功能测试)
3. [集成测试](#集成测试)
4. [性能测试](#性能测试)
5. [常见问题排查](#常见问题排查)

## 测试环境准备

### 前置条件

- Chrome 浏览器（版本 88 或更高）
- Cloudflare 账户
- Wrangler CLI 已安装
- Node.js 和 npm

### 设置测试环境

1. **部署 Cloudflare Worker**
   ```bash
   cd worker
   npm install
   wrangler login
   wrangler d1 create BOOKMARK_DB_TEST
   ```

2. **更新配置**
   - 编辑 `wrangler.toml` 文件，更新测试环境的数据库 ID
   - 设置测试环境的环境变量：
     ```bash
     wrangler secret put JWT_SECRET --env test
     wrangler secret put CORS_ORIGIN --env test
     ```

3. **运行数据库迁移**
   ```bash
   npm run migrate:test
   ```

4. **部署 Worker**
   ```bash
   npm run deploy --env test
   ```

5. **配置 Chrome 扩展**
   - 打开 Chrome 浏览器，访问 `chrome://extensions/`
   - 启用"开发者模式"
   - 点击"加载已解压的扩展程序"
   - 选择 `extension` 文件夹
   - 记下扩展 ID

6. **更新 API URL**
   - 编辑 `extension/config/config.js`，更新 API URL 为测试环境的 Worker URL
   - 在扩展选项页面中更新 API URL

## 功能测试

### 用户认证测试

#### 1. 用户注册测试

**步骤：**
1. 点击扩展图标打开弹出窗口
2. 点击"注册"链接
3. 输入有效的邮箱地址和密码（至少6位）
4. 点击"注册"按钮

**预期结果：**
- 显示"注册成功"的通知
- 自动登录并显示收藏夹管理界面
- 用户信息保存在本地存储中

**验证方法：**
- 检查通知是否显示成功消息
- 检查是否自动跳转到收藏夹管理界面
- 检查 `chrome.storage.local` 中是否保存了认证令牌

#### 2. 用户登录测试

**步骤：**
1. 点击扩展图标打开弹出窗口
2. 输入已注册的邮箱地址和密码
3. 点击"登录"按钮

**预期结果：**
- 显示"登录成功"的通知
- 跳转到收藏夹管理界面
- 用户信息正确显示

**验证方法：**
- 检查通知是否显示成功消息
- 检查是否跳转到收藏夹管理界面
- 检查用户信息是否正确显示

#### 3. 用户登出测试

**步骤：**
1. 确保已登录
2. 点击"退出"按钮

**预期结果：**
- 显示"已退出登录"的通知
- 跳转到登录界面
- 本地存储中的认证令牌被清除

**验证方法：**
- 检查通知是否显示成功消息
- 检查是否跳转到登录界面
- 检查 `chrome.storage.local` 中的认证令牌是否被清除

### 收藏夹管理测试

#### 1. 添加收藏夹测试

**步骤：**
1. 确保已登录
2. 在收藏夹管理界面中输入标题和URL
3. 点击"添加"按钮

**预期结果：**
- 显示"收藏夹添加成功"的通知
- 收藏夹出现在列表中
- 输入框被清空

**验证方法：**
- 检查通知是否显示成功消息
- 检查收藏夹是否出现在列表中
- 检查输入框是否被清空

#### 2. 查看收藏夹测试

**步骤：**
1. 确保已登录且有收藏夹
2. 检查收藏夹列表

**预期结果：**
- 所有收藏夹正确显示
- 收藏夹信息（标题、URL）正确

**验证方法：**
- 检查收藏夹列表是否显示所有收藏夹
- 检查收藏夹信息是否正确

#### 3. 编辑收藏夹测试

**步骤：**
1. 确保已登录且有收藏夹
2. 点击收藏夹项的"编辑"按钮
3. 修改标题或URL
4. 点击"保存"按钮

**预期结果：**
- 显示"收藏夹更新成功"的通知
- 收藏夹信息更新
- 编辑模态框关闭

**验证方法：**
- 检查通知是否显示成功消息
- 检查收藏夹信息是否更新
- 检查编辑模态框是否关闭

#### 4. 删除收藏夹测试

**步骤：**
1. 确保已登录且有收藏夹
2. 点击收藏夹项的"删除"按钮
3. 在确认对话框中点击"确定"

**预期结果：**
- 显示"收藏夹删除成功"的通知
- 收藏夹从列表中移除

**验证方法：**
- 检查通知是否显示成功消息
- 检查收藏夹是否从列表中移除

### 扩展功能测试

#### 1. 右键菜单测试

**步骤：**
1. 在任意网页上右键点击
2. 选择"添加到收藏夹"选项

**预期结果：**
- 显示"页面信息已保存"的通知
- 页面信息保存在临时存储中

**验证方法：**
- 检查通知是否显示成功消息
- 检查 `chrome.storage.local` 中是否保存了页面信息

#### 2. 浮动按钮测试

**步骤：**
1. 在选项页面中启用浮动按钮
2. 刷新网页
3. 点击浮动按钮

**预期结果：**
- 显示"页面信息已保存"的通知
- 页面信息保存在临时存储中

**验证方法：**
- 检查通知是否显示成功消息
- 检查 `chrome.storage.local` 中是否保存了页面信息

#### 3. 数据导入/导出测试

**导出测试：**
1. 确保已登录且有收藏夹
2. 在选项页面中点击"导出收藏夹"按钮

**预期结果：**
- 收藏夹数据导出为 JSON 文件
- 文件下载到本地

**验证方法：**
- 检查是否下载了 JSON 文件
- 检查文件内容是否正确

**导入测试：**
1. 确保已登录
2. 在选项页面中点击"导入收藏夹"按钮
3. 选择之前导出的 JSON 文件

**预期结果：**
- 显示导入结果通知
- 收藏夹添加到列表中

**验证方法：**
- 检查通知是否显示导入结果
- 检查收藏夹是否添加到列表中

## 集成测试

### 前后端集成测试

#### 1. API 连接测试

**步骤：**
1. 使用开发者工具检查网络请求
2. 执行各种操作（登录、添加收藏夹等）

**预期结果：**
- 所有 API 请求成功
- 响应数据格式正确
- 错误处理正确

**验证方法：**
- 检查网络请求是否成功
- 检查响应数据格式是否正确
- 检查错误是否正确处理

#### 2. 数据同步测试

**步骤：**
1. 在多个设备上登录同一账户
2. 在一个设备上添加/编辑/删除收藏夹
3. 在另一个设备上刷新收藏夹列表

**预期结果：**
- 收藏夹数据在设备间同步
- 数据一致性保持

**验证方法：**
- 检查收藏夹数据是否同步
- 检查数据一致性是否保持

### 跨浏览器测试

#### 测试浏览器兼容性

**步骤：**
1. 在不同版本的 Chrome 浏览器上测试扩展
2. 执行主要功能测试

**预期结果：**
- 扩展在不同版本的 Chrome 上正常工作
- 功能一致性保持

**验证方法：**
- 检查扩展是否正常加载
- 检查主要功能是否正常工作

## 性能测试

### 响应时间测试

#### 1. API 响应时间测试

**步骤：**
1. 使用开发者工具测量 API 请求的响应时间
2. 执行各种 API 请求

**预期结果：**
- 所有 API 请求在合理时间内完成（通常 < 2秒）
- 响应时间稳定

**验证方法：**
- 检查 API 请求的响应时间
- 检查响应时间是否稳定

#### 2. 界面响应时间测试

**步骤：**
1. 测量各种操作的界面响应时间
2. 包括页面加载、按钮点击等

**预期结果：**
- 界面响应迅速（通常 < 500ms）
- 用户体验流畅

**验证方法：**
- 检查界面响应时间
- 检查用户体验是否流畅

### 资源使用测试

#### 1. 内存使用测试

**步骤：**
1. 使用 Chrome 任务管理器监控扩展的内存使用
2. 执行各种操作

**预期结果：**
- 内存使用在合理范围内
- 无内存泄漏

**验证方法：**
- 检查内存使用量
- 检查是否存在内存泄漏

#### 2. CPU 使用测试

**步骤：**
1. 使用 Chrome 任务管理器监控扩展的 CPU 使用
2. 执行各种操作

**预期结果：**
- CPU 使用在合理范围内
- 无 CPU 过载

**验证方法：**
- 检查 CPU 使用量
- 检查是否存在 CPU 过载

## 常见问题排查

### 连接问题

#### 问题：无法连接到 API

**可能原因：**
- API URL 配置错误
- 网络连接问题
- Worker 部署问题

**解决方案：**
1. 检查 API URL 配置是否正确
2. 检查网络连接是否正常
3. 检查 Worker 是否正确部署
4. 查看 Chrome 开发者工具的控制台和网络选项卡

#### 问题：CORS 错误

**可能原因：**
- CORS 配置错误
- 扩展 ID 配置错误

**解决方案：**
1. 检查 Worker 中的 CORS 配置
2. 检查扩展 ID 是否正确配置
3. 查看 Chrome 开发者工具的控制台

### 认证问题

#### 问题：无法登录

**可能原因：**
- 邮箱或密码错误
- JWT 令牌问题
- 数据库连接问题

**解决方案：**
1. 检查邮箱和密码是否正确
2. 检查 JWT 令牌是否正确生成和验证
3. 检查数据库连接是否正常
4. 查看 Chrome 开发者工具的控制台和网络选项卡

#### 问题：自动登录失败

**可能原因：**
- 本地存储问题
- 令牌过期
- 验证 API 问题

**解决方案：**
1. 检查本地存储是否正常工作
2. 检查令牌是否过期
3. 检查验证 API 是否正常工作
4. 查看 Chrome 开发者工具的控制台和网络选项卡

### 数据问题

#### 问题：收藏夹数据不同步

**可能原因：**
- 数据库连接问题
- API 问题
- 缓存问题

**解决方案：**
1. 检查数据库连接是否正常
2. 检查 API 是否正常工作
3. 清除缓存并重试
4. 查看 Chrome 开发者工具的控制台和网络选项卡

#### 问题：数据导入/导出失败

**可能原因：**
- 文件格式问题
- 数据格式问题
- API 问题

**解决方案：**
1. 检查文件格式是否正确
2. 检查数据格式是否符合要求
3. 检查 API 是否正常工作
4. 查看 Chrome 开发者工具的控制台和网络选项卡

### 扩展问题

#### 问题：扩展无法加载

**可能原因：**
- Manifest 文件错误
- 文件路径问题
- 权限问题

**解决方案：**
1. 检查 Manifest 文件是否有语法错误
2. 检查文件路径是否正确
3. 检查权限配置是否正确
4. 查看 Chrome 扩展管理页面的错误信息

#### 问题：浮动按钮不显示

**可能原因：**
- 设置问题
- 内容脚本问题
- CSS 问题

**解决方案：**
1. 检查浮动按钮设置是否启用
2. 检查内容脚本是否正确加载
3. 检查 CSS 样式是否正确
4. 查看 Chrome 开发者工具的控制台和元素选项卡